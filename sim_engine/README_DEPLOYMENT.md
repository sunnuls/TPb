# Multi-Agent Simulation Research Framework - Deployment Guide

**Educational Use Only**: This deployment guide is for academic research purposes, studying multi-agent coordination patterns in game theory contexts.

## Overview

This framework provides cloud-based deployment for multi-agent simulations with support for:
- Scalable orchestration (up to 100 agents)
- Multi-region network diversity
- Secure protocols and encryption
- Real-time monitoring and metrics
- Containerized deployment

## Prerequisites

- Docker 20.10+
- Docker Compose 2.0+
- Python 3.11+
- 4GB RAM minimum (8GB+ recommended for 50+ agents)
- Multi-core CPU (4+ cores recommended)

## Quick Start

### 1. Basic Deployment

```bash
# Linux/Mac
cd sim_engine
./deploy_cloud.sh

# Windows (PowerShell)
cd sim_engine
.\deploy_cloud.ps1
```

### 2. Custom Configuration

```bash
# Deploy with custom agent count
AGENT_COUNT=50 REPLICA_COUNT=5 ./deploy_cloud.sh

# PowerShell
.\deploy_cloud.ps1 -AgentCount 50 -ReplicaCount 5
```

### 3. Multi-Region Setup

```bash
# Enable multi-region deployment
export ENABLE_MULTI_REGION=true
export REGION=us-east-1
./deploy_cloud.sh
```

## Configuration

### Environment Variables (Подпункт 1.2)

All configuration is managed through `.env` file:

```bash
# Core simulation
AGENT_COUNT=10              # Number of agents per replica
REPLICA_COUNT=2             # Number of agent pool replicas
SIMULATION_DURATION=3600    # Session duration (seconds)

# Security (secure protocols)
ENCRYPTION_ENABLED=true
JWT_SECRET=<auto-generated>
ENCRYPTION_KEY=<auto-generated>

# Multi-region (Пункт 1: network diversity)
REGION=us-east-1
ENABLE_MULTI_REGION=true

# Monitoring
ENABLE_METRICS=true
PROMETHEUS_PORT=9090
```

### Scaling (Подпункт 1.1)

Scale to 100 agents:

```bash
# Method 1: Environment variable
export AGENT_COUNT=50
export REPLICA_COUNT=2
docker-compose up -d --scale agent-pool=2

# Method 2: Direct scaling
docker-compose up -d --scale agent-pool=10  # 10 replicas × 10 agents = 100 agents
```

## Architecture

```
┌─────────────────────────────────────────────────┐
│                  Cloud Platform                  │
│  ┌──────────────────────────────────────────┐  │
│  │         Central Hub (Coordination)        │  │
│  │         WebSocket Server (8765)           │  │
│  └──────────────────────────────────────────┘  │
│                       │                          │
│         ┌─────────────┼─────────────┐           │
│         │             │             │           │
│  ┌──────▼──────┐ ┌───▼─────┐ ┌────▼──────┐    │
│  │ Agent Pool  │ │  Agent  │ │   Agent   │    │
│  │ (Replica 1) │ │  Pool   │ │   Pool    │    │
│  │  10 agents  │ │  (R2)   │ │   (R3)    │    │
│  └─────────────┘ └─────────┘ └───────────┘    │
│         │             │             │           │
│  ┌──────▼─────────────▼─────────────▼──────┐  │
│  │         Redis (State Cache)               │  │
│  └───────────────────────────────────────────┘  │
│         │                                        │
│  ┌──────▼─────────────────────────────────┐    │
│  │  Prometheus → Grafana (Monitoring)      │    │
│  └─────────────────────────────────────────┘    │
└─────────────────────────────────────────────────┘
```

## Services

### Central Hub
- **Port**: 8765 (WebSocket), 8000 (API)
- **Purpose**: Agent coordination and state synchronization
- **Health Check**: Automatic with retries

### Agent Pool
- **Replicas**: Configurable (default: 2)
- **Agents per Replica**: Configurable (default: 10)
- **Purpose**: Execute research simulations
- **Resource Limits**: 1 CPU, 1GB RAM per replica

### Redis
- **Port**: 6379
- **Purpose**: State caching and persistence
- **Security**: Password-protected

### Monitoring Stack
- **Prometheus**: http://localhost:9090
- **Grafana**: http://localhost:3000 (admin/research_sim)

## Commands

### Service Management

```bash
# Start services
docker-compose up -d

# Stop services
docker-compose down

# Restart specific service
docker-compose restart central-hub

# View logs
docker-compose logs -f
docker-compose logs -f agent-pool
docker-compose logs -f central-hub

# Check status
docker-compose ps
```

### Scaling Operations

```bash
# Scale up to 100 agents (10 replicas × 10 agents)
docker-compose up -d --scale agent-pool=10

# Scale down
docker-compose up -d --scale agent-pool=2

# Rolling restart (zero-downtime)
docker-compose up -d --scale agent-pool=3
docker-compose restart agent-pool
```

### Monitoring

```bash
# View metrics
curl http://localhost:8000/metrics

# Check health
curl http://localhost:8000/health

# Redis stats
docker-compose exec redis redis-cli INFO
```

## Multi-Region Deployment (Пункт 1)

For true multi-region deployment on cloud platforms:

### AWS EC2 Example

```bash
# Region 1: US East
export REGION=us-east-1
./deploy_cloud.sh

# Region 2: US West (separate EC2 instance)
export REGION=us-west-2
export CENTRAL_HUB_HOST=<region-1-hub-ip>
./deploy_cloud.sh
```

### Network Diversity

The framework simulates network diversity through:
- Multiple replica regions
- Proxy rotation (optional)
- Variable latency injection
- Connection pooling

## Security (Подпункт 1.2)

### Secure Protocols

- **Encryption**: AES-256 via Fernet (cryptography)
- **Authentication**: JWT tokens
- **Transport**: WSS (WebSocket Secure) for production
- **Secrets**: Auto-generated on first deployment

### Best Practices

1. **Never commit** `.env` file
2. **Rotate keys** regularly (every 90 days)
3. **Use TLS** in production (configure reverse proxy)
4. **Firewall rules**: Restrict access to known IPs
5. **Audit logs**: Review regularly for anomalies

## Troubleshooting

### Services Won't Start

```bash
# Check logs
docker-compose logs

# Rebuild images
docker-compose build --no-cache

# Reset everything
docker-compose down -v
docker-compose up -d
```

### Out of Memory

```bash
# Reduce agent count
export AGENT_COUNT=5
docker-compose up -d

# Increase Docker memory limit (Docker Desktop)
# Settings → Resources → Memory → 8GB+
```

### Connection Issues

```bash
# Check network
docker network inspect sim_sim_network

# Test connectivity
docker-compose exec agent-pool ping central-hub

# Check firewall
# Windows: New-NetFirewallRule -DisplayName "Sim Hub" -Direction Inbound -LocalPort 8765 -Protocol TCP -Action Allow
# Linux: sudo ufw allow 8765/tcp
```

## Performance Tuning

### For 100 Agents

```yaml
# docker-compose.yml adjustments
services:
  agent-pool:
    deploy:
      resources:
        limits:
          cpus: '2.0'      # Increase CPU
          memory: 2G       # Increase RAM
        reservations:
          cpus: '1.0'
          memory: 1G
```

### Environment Variables

```bash
# .env optimizations
WORKER_THREADS=8
MAX_CONCURRENT_DECISIONS=100
MONTE_CARLO_SIMULATIONS=500  # Reduce for speed
```

## Educational Compliance

This framework is designed for:
- ✅ Academic research and education
- ✅ Game theory studies
- ✅ Multi-agent system research
- ✅ Algorithm development and testing

**Not intended for**:
- ❌ Real-money gaming
- ❌ Production gambling applications
- ❌ Commercial exploitation

All data is anonymized and used solely for research purposes.

## Support & Contributions

This is an educational research framework. For questions or contributions:
1. Review existing documentation
2. Check troubleshooting section
3. Review code comments
4. Consult academic literature on multi-agent systems

---

**Version**: 1.0.0  
**Last Updated**: 2026-02-06  
**License**: Educational Research Use Only
